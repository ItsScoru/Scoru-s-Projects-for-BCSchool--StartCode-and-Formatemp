package lezione21.esercizi;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class DatabaseGatti {

    /*
     * Creare una classe Java contenente il metodo main ed i seguenti metodi statici
     * implementati:
     * •aggiungiGatto(), al quale dovranno essere passati come parametri gli
     * attributi relativi amicrochip, nome, età e colorePelo
     * •stampaGatti()
     */

    public static void main(String[] args) {

        aggiungiGatto(1, "Francesco", 3, "Grigio");
        aggiungiGatto(2, "Lilith", 4, "Bianco e tigrato");
        aggiungiGatto(3, "Carmine", 6, "Bianco e arancione");
        aggiungiGatto(4, "Mimmo", 1, "Bianco e nero");
        aggiungiGatto(5, "Irma", 2, "Calico");
        aggiungiGatto(6, "Iside", 4, null);

    }

    public static void aggiungiGatto(int microchip, String nome, int età, String colorePelo) {

        Connection conn = null;
        PreparedStatement stmt = null;

        String url = "jdbc:mysql://localhost:3306/gatti";
        String username = "root";
        String password = "";

        try {

            Class.forName("com.mysql.cj.jdbc.Driver");

            conn = DriverManager.getConnection(url, username, password);

            String insert = "INSERT INTO dip VALUES (?, ?, ?, ?);";
            
            stmt = conn.prepareStatement(insert);

            stmt.setInt(1, microchip);
            stmt.setString(2, nome);
            stmt.setInt(3, età);
            stmt.setString(4, colorePelo);
            
            stmt.execute();

        } catch (ClassNotFoundException e) {
			System.out.println("Classe non trovata");
			e.printStackTrace();
		} catch (SQLException e) {
			System.out.println("Eccezione specifica SQL");
			e.printStackTrace();
		} catch (Exception e) {
			System.out.println("Eccezione generica");
			e.printStackTrace();
		} finally {

            if (stmt != null) {
                try {
                    stmt.close();
                    stmt = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura dello statement");
                    e.printStackTrace();
                }
            }

            if (conn != null) {
                try {
                    conn.close();
                    conn = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura di Connection");
                    e.printStackTrace();
                }
            }

        }

    }

    public static void stampaGatti() {

        Connection conn = null;
        PreparedStatement stmt = null;
        ResultSet rs = null;

        String url = "jdbc:mysql://localhost:3306/gatti";
        String username = "root";
        String password = "";

        try {

            Class.forName("com.mysql.cj.jdbc.Driver");

            conn = DriverManager.getConnection(url, username, password);

            stmt = conn.prepareStatement("SELECT * FROM gatto");

            rs = stmt.executeQuery("");

            while (rs.next()) {

                System.out.println("Gatto: " + rs.getInt(1) + ", '" + rs.getString(2)
                        + "'', " + rs.getInt(3) + ", " + rs.getString(4));

            }

        } catch (ClassNotFoundException e) {
			System.out.println("Classe non trovata");
			e.printStackTrace();
		} catch (SQLException e) {
			System.out.println("Eccezione specifica SQL");
			e.printStackTrace();
		} catch (Exception e) {
			System.out.println("Eccezione generica");
			e.printStackTrace();
		} finally {

            if (rs != null) {
                try {
                    rs.close();
                    rs = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura del ResultSet");
                    e.printStackTrace();
                }
            }

            if (stmt != null) {
                try {
                    stmt.close();
                    stmt = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura dello statement");
                    e.printStackTrace();
                }
            }

            if (conn != null) {
                try {
                    conn.close();
                    conn = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura di Connection");
                    e.printStackTrace();
                }
            }

        }

    }

    public static void cancellaGatto(int microchip) {

        Connection conn = null;
        Statement stmt = null;

        String url = "jdbc:mysql://localhost:3306/gatti";
        String username = "root";
        String password = "";

        try {

            Class.forName("com.mysql.cj.jdbc.Driver");

            conn = DriverManager.getConnection(url, username, password);

            stmt = conn.createStatement();

            String insert = "DELETE FROM gatto WHERE gattto.microchip = " + microchip + ";";

            int result = stmt.executeUpdate(insert);

            if (result > 0)
				System.out.println(result);
			else
				System.out.println("Problemi durante l'inserimento");

        } catch (ClassNotFoundException e) {
			System.out.println("Classe non trovata");
			e.printStackTrace();
		} catch (SQLException e) {
			System.out.println("Eccezione specifica SQL");
			e.printStackTrace();
		} catch (Exception e) {
			System.out.println("Eccezione generica");
			e.printStackTrace();
		} finally {

            if (stmt != null) {
                try {
                    stmt.close();
                    stmt = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura dello statement");
                    e.printStackTrace();
                }
            }

            if (conn != null) {
                try {
                    conn.close();
                    conn = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura di Connection");
                    e.printStackTrace();
                }
            }

        }

    }

    public static void cancellaAll() {

        Connection conn = null;
        Statement stmt = null;

        String url = "jdbc:mysql://localhost:3306/gatti";
        String username = "root";
        String password = "";

        try {

            Class.forName("com.mysql.cj.jdbc.Driver");

            conn = DriverManager.getConnection(url, username, password);

            stmt = conn.createStatement();

            String insert = "DELETE FROM gatto";

            int result = stmt.executeUpdate(insert);

            if (result > 0)
				System.out.println(result);
			else
				System.out.println("Problemi durante l'inserimento");

        } catch (ClassNotFoundException e) {
			System.out.println("Classe non trovata");
			e.printStackTrace();
		} catch (SQLException e) {
			System.out.println("Eccezione specifica SQL");
			e.printStackTrace();
		} catch (Exception e) {
			System.out.println("Eccezione generica");
			e.printStackTrace();
		} finally {

            if (stmt != null) {
                try {
                    stmt.close();
                    stmt = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura dello statement");
                    e.printStackTrace();
                }
            }

            if (conn != null) {
                try {
                    conn.close();
                    conn = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura di Connection");
                    e.printStackTrace();
                }
            }

        }

    }

    public static void aggiornaByName(int microchip, String nuovoNome) {

        Connection conn = null;
        Statement stmt = null;

        String url = "jdbc:mysql://localhost:3306/gatti";
        String username = "root";
        String password = "";

        try {

            Class.forName("com.mysql.cj.jdbc.Driver");

            conn = DriverManager.getConnection(url, username, password);

            stmt = conn.createStatement();

            String insert = "UPDATE gatto SET gatto.nome = '" + nuovoNome + "' WHERE gatto.microchip = "
                    + microchip + ";";

            int result = stmt.executeUpdate(insert);

            if (result > 0)
				System.out.println(result);
			else
				System.out.println("Problemi durante l'inserimento");

        } catch (ClassNotFoundException e) {
			System.out.println("Classe non trovata");
			e.printStackTrace();
		} catch (SQLException e) {
			System.out.println("Eccezione specifica SQL");
			e.printStackTrace();
		} catch (Exception e) {
			System.out.println("Eccezione generica");
			e.printStackTrace();
		} finally {

            if (stmt != null) {
                try {
                    stmt.close();
                    stmt = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura dello statement");
                    e.printStackTrace();
                }
            }

            if (conn != null) {
                try {
                    conn.close();
                    conn = null;
                } catch (SQLException e) {
                    System.out.println("Errore durante la chiusura di Connection");
                    e.printStackTrace();
                }
            }

        }

    }

}